<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Laam Wallet Connect â€” Stellar Network</title>
  <meta name="description" content="Securely connect to the Stellar network using your secret key to view your account data and balances." />
  <!-- Stellar SDK Library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/stellar-sdk/11.2.1/stellar-sdk.min.js"></script>

  <style>
    :root {
      --bg: #0f1226; --card: #181b37; --muted: #9aa3b2; --txt: #e8ebf4;
      --accent: #6c7bff; --accent2: #29d3c6; --chip: #22274b;
      --danger: #ff4d4d; --danger-bg: rgba(255, 77, 77, 0.1);
      --success: #29d3c6; --success-bg: rgba(41, 211, 198, 0.1);
    }
    * { box-sizing: border-box; }
    body {
      margin: 0; font-family: Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      background: radial-gradient(1200px 800px at 20% -10%, #1e2250 0%, transparent 60%), var(--bg);
      color: var(--txt); min-height: 100vh; display: flex; flex-direction: column;
    }
    header { padding: 28px 16px 8px; text-align: center; }
    .title { font-weight: 800; letter-spacing: .5px; font-size: clamp(22px, 3vw, 32px); }
    .subtitle { color: var(--muted); margin-top: 6px; font-size: 14px; }
    .shell { width: min(600px, 95%); margin: 18px auto 40px; }
    
    /* Styles for Wallet Connect Section */
    .wallet-connect-section {
      background: var(--card); border: 1px solid #23264b; border-radius: 16px;
      padding: 25px; box-shadow: 0 8px 30px rgba(0,0,0,.2);
    }
    .secret-key-warning {
      font-size: 12px; color: var(--danger); background: var(--danger-bg);
      padding: 10px; border-radius: 8px; text-align: center; margin-bottom: 15px;
    }
    #secret-key-input {
      width: 100%; background: #111437; border: 1px solid #222657; border-radius: 12px;
      padding: 14px; color: var(--txt); margin-bottom: 15px; font-size: 16px;
    }
    .connect-button {
      width: 100%; padding: 14px; border-radius: 12px; border: none; background: var(--accent);
      color: white; font-weight: bold; cursor: pointer; font-size: 16px;
      transition: background-color 0.2s;
    }
    .connect-button:disabled { background: #22274b; color: var(--muted); cursor: not-allowed; }
    .connect-button:hover:not(:disabled) { background: #5a68e8; }
    
    #status-message {
        margin-top: 15px; padding: 12px; border-radius: 8px; text-align: center; display: none;
        font-size: 14px; word-break: break-all;
    }
    #status-message.success { background: var(--success-bg); color: var(--success); }
    #status-message.error { background: var(--danger-bg); color: var(--danger); }

    /* Styles for Account Data Display */
    #account-data-section {
        display: none; margin-top: 20px;
    }
    .account-data-title {
        font-size: 18px; font-weight: 600; margin-bottom: 15px;
        border-bottom: 1px solid #23264b; padding-bottom: 10px;
    }
    .data-row {
        display: flex; justify-content: space-between; align-items: center;
        padding: 10px 0; border-bottom: 1px solid #111437;
    }
    .data-row:last-child { border-bottom: none; }
    .data-label { color: var(--muted); }
    .data-value { font-weight: 600; word-break: break-all; text-align: right; }
    .data-value .asset-code { color: var(--accent2); }
  </style>
</head>
<body>
  <header>
    <div class="title">Laam Wallet Connect</div>
    <div class="subtitle">Connect to the Stellar Network to view your account balances.</div>
  </header>

  <div class="shell">
    <div class="wallet-connect-section">
      <div class="secret-key-warning">
        <strong>DIGNIIN:</strong> Waligaa ha la wadaagin Secret Key-gaaga. Isticmaalkaagu waa mas'uuliyaddaada.
      </div>
      <input type="password" id="secret-key-input" placeholder="Geli Secret Key-gaaga (wuxuu ku bilaabmaa 'S')">
      <button id="connect-btn" class="connect-button">Connect Wallet</button>
      <div id="status-message"></div>
    </div>

    <div id="account-data-section">
      <div class="account-data-title">Account Details</div>
      <div id="account-info"></div>
    </div>
  </div>

<script>
(async function () {
  const connectBtn = document.getElementById('connect-btn');
  const secretKeyInput = document.getElementById('secret-key-input');
  const statusMessageEl = document.getElementById('status-message');
  const accountDataSection = document.getElementById('account-data-section');
  const accountInfoEl = document.getElementById('account-info');

  const server = new StellarSdk.Server("https://horizon.stellar.org");

  function showStatus(message, isError = false) {
    statusMessageEl.textContent = message;
    statusMessageEl.className = isError ? 'error' : 'success';
    statusMessageEl.style.display = 'block';
  }

  function displayAccountData(account) {
    accountDataSection.style.display = 'block';
    accountInfoEl.innerHTML = ''; // Clear previous data

    // Display Public Key
    const pkRow = `<div class="data-row">
                     <span class="data-label">Public Key</span>
                     <span class="data-value">${account.id}</span>
                   </div>`;
    accountInfoEl.innerHTML += pkRow;

    // Display Balances
    account.balances.forEach(balance => {
      const assetCode = balance.asset_type === 'native' ? 'XLM' : balance.asset_code;
      const amount = parseFloat(balance.balance).toLocaleString('en-US', { maximumFractionDigits: 7 });
      
      const balanceRow = `<div class="data-row">
                            <span class="data-label">Balance</span>
                            <span class="data-value">${amount} <span class="asset-code">${assetCode}</span></span>
                          </div>`;
      accountInfoEl.innerHTML += balanceRow;
    });
  }

  connectBtn.addEventListener('click', async () => {
    const secretKey = secretKeyInput.value.trim();
    if (!secretKey) {
      showStatus("Fadlan geli Secret Key-gaaga.", true);
      return;
    }

    let sourceKeys;
    try {
      sourceKeys = StellarSdk.Keypair.fromSecret(secretKey);
    } catch (e) {
      showStatus("Secret Key-gaagu waa qaldan yahay. Fadlan hubi.", true);
      accountDataSection.style.display = 'none'; // Hide data section on error
      return;
    }

    showStatus("Connecting to Stellar Network...", false);
    connectBtn.disabled = true;
    connectBtn.textContent = "Connecting...";
    accountDataSection.style.display = 'none';

    try {
      const account = await server.loadAccount(sourceKeys.publicKey());
      showStatus("Successfully connected!", false);
      displayAccountData(account);
      
    } catch (error) {
      console.error("Stellar Connection Error:", error);
      let errorMessage = "Could not load account. ";
      if (error.response && error.response.status === 404) {
        errorMessage += "This account does not exist on the public network.";
      } else {
        errorMessage += "Please check your network connection and try again.";
      }
      showStatus(errorMessage, true);
    } finally {
      connectBtn.disabled = false;
      connectBtn.textContent = "Connect Wallet";
    }
  });

})();
</script>
</body>
</html>
