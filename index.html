<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Laam Pools â€” Stellar AMM Explorer</title>
  <meta name="description" content="Lightweight Stellar AMM pools explorer like Aqua. Browse, sort, and filter liquidity pools." />

  <style>
    :root {
      --bg: #0f1226;
      --card: #181b37;
      --muted: #9aa3b2;
      --txt: #e8ebf4;
      --accent: #6c7bff;
      --accent2: #29d3c6;
      --chip: #22274b;
      --ring: rgba(108, 123, 255, .35);
    }
    * { box-sizing: border-box; }
    body {
      margin: 0; font-family: Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      background: radial-gradient(1200px 800px at 20% -10%, #1e2250 0%, transparent 60%), var(--bg);
      color: var(--txt);
      min-height: 100vh; display: flex; flex-direction: column;
    }
    header {
      padding: 28px 16px 8px; text-align: center;
    }
    .title { font-weight: 800; letter-spacing: .5px; font-size: clamp(22px, 3vw, 32px); }
    .subtitle { color: var(--muted); margin-top: 6px; font-size: 14px; }
    .shell { width: min(1100px, 95%); margin: 18px auto 40px; }
    .toolbar {
      display: grid; grid-template-columns: 1fr auto auto; gap: 10px; align-items: center;
      background: var(--card); padding: 14px; border-radius: 16px; box-shadow: 0 8px 30px rgba(0,0,0,.25);
      position: sticky; top: 12px; z-index: 5; border: 1px solid #23264b;
      backdrop-filter: blur(6px);
    }
    .search {
      display: flex; align-items: center; gap: 10px; background: #111437; padding: 10px 12px; border-radius: 12px; border: 1px solid #222657;
      box-shadow: 0 0 0 0 var(--ring);
    }
    .search:focus-within { box-shadow: 0 0 0 4px var(--ring); }
    .search input {
      outline: none; border: 0; background: transparent; color: var(--txt); width: 100%;
    }
    select, button {
      background: #111437; color: var(--txt); border: 1px solid #222657; border-radius: 12px; padding: 10px 12px;
    }
    button { cursor: pointer; }
    .table {
      margin-top: 14px; background: var(--card); border-radius: 16px; overflow: hidden; border: 1px solid #23264b;
    }
    table { width: 100%; border-collapse: collapse; }
    thead th {
      text-align: left; font-size: 12px; text-transform: uppercase; letter-spacing: .08em; color: var(--muted);
      background: #15183a; padding: 12px 14px; border-bottom: 1px solid #23264b; position: sticky; top: 64px; z-index: 4;
    }
    tbody td { padding: 14px; border-bottom: 1px solid #23264b; }
    tbody tr:hover { background: rgba(255,255,255,0.03); }
    .pair { display: flex; align-items: center; gap: 10px; font-weight: 650; }
    .chip { background: var(--chip); color: #c6cff9; padding: 3px 8px; border-radius: 999px; font-size: 12px; border: 1px solid #2b2f5c; }
    .muted { color: var(--muted); font-size: 12px; }
    .tag { font-size: 11px; padding: 2px 6px; border-radius: 999px; border: 1px solid #2b2f5c; background: #14173a; color: #b6c0ff; }
    .foot { color: var(--muted); text-align: center; font-size: 12px; padding: 24px 0 40px; }
    .pill {
      display:inline-flex; gap:8px; align-items:center; padding:8px 12px; border-radius:999px; background:#12163a; border:1px solid #2b2f5c; font-size:12px;
    }
    .link {
      color: var(--accent2); text-decoration: none;
    }
    .link:hover { text-decoration: underline; }
    .spinner {
      margin: 40px auto; width: 44px; aspect-ratio: 1; border-radius: 50%;
      border: 4px solid #2b2f5c; border-top-color: var(--accent); animation: spin 1s linear infinite;
    }
    @keyframes spin { to { transform: rotate(1turn); } }
    @media (max-width: 720px){
      .toolbar { grid-template-columns: 1fr; position: static; }
      thead { display:none; }
      tbody td { display:block; border:0; padding:8px 14px; }
      tbody tr { border-bottom: 1px solid #23264b; padding: 8px 0; }
      .row {
        display:grid; grid-template-columns: 1fr; gap:6px;
      }
      .cell-label { color: var(--muted); font-size: 11px; text-transform: uppercase; letter-spacing: .08em; }
    }
  </style>
</head>
<body>
  <header>
    <div class="title">Laam Pools â€” Stellar AMM</div>
    <div class="subtitle">Browse Stellar liquidity pools. Filter by asset and sort by reserves, fee, or total shares.</div>
  </header>

  <div class="shell">
    <div class="toolbar">
      <div class="search">
        ðŸ”Ž
        <input id="q" placeholder="Filter by asset code (e.g., XLM, USDC, Laam)..." />
      </div>
      <select id="sort">
        <option value="-liquidity">Sort: Reserves (desc)</option>
        <option value="liquidity">Sort: Reserves (asc)</option>
        <option value="-shares">Sort: Total shares (desc)</option>
        <option value="shares">Sort: Total shares (asc)</option>
        <option value="-fee">Sort: Fee (desc)</option>
        <option value="fee">Sort: Fee (asc)</option>
      </select>
      <button id="refresh">â†» Refresh</button>
    </div>

    <div id="status" class="pill" style="margin-top:12px; display:none;">Loadingâ€¦</div>

    <div class="table">
      <div id="loading" class="spinner"></div>
      <table>
        <thead>
          <tr>
            <th style="min-width:220px">Pair</th>
            <th>Reserves</th>
            <th>Fee (bp)</th>
            <th>Total Shares</th>
            <th>Pool</th>
          </tr>
        </thead>
        <tbody id="rows"></tbody>
      </table>
    </div>

    <div class="foot">
      Data live from <a class="link" href="https://horizon.stellar.org" target="_blank" rel="noopener">Horizon Public Network</a>.
      Links open on StellarExpert.
    </div>
  </div>

<script>
(async function () {
  const API = "https://horizon.stellar.org/liquidity_pools?order=desc&limit=200";
  const rowsEl = document.getElementById('rows');
  const qEl = document.getElementById('q');
  const sortEl = document.getElementById('sort');
  const refreshBtn = document.getElementById('refresh');
  const loadingEl = document.getElementById('loading');
  const statusEl = document.getElementById('status');

  let POOLS = [];

  function assetLabel(r) {
    if (!r) return "?";
    if (r.asset === "native") return "XLM";
    // "CODE:ISSUER"
    const [code] = r.asset.split(":");
    return code || r.asset;
  }

  function fmt(n, max=2){
    const num = typeof n === "number" ? n : parseFloat(n || 0);
    if (!isFinite(num)) return "0";
    return new Intl.NumberFormat(undefined, {maximumFractionDigits:max}).format(num);
  }

  function render(list){
    rowsEl.innerHTML = "";
    for (const p of list){
      const a = assetLabel(p.reserves?.[0]);
      const b = assetLabel(p.reserves?.[1]);
      const aAmt = p.reserves?.[0]?.amount ?? 0;
      const bAmt = p.reserves?.[1]?.amount ?? 0;
      const pair = `${a}/${b}`;
      const tr = document.createElement('tr');
      tr.className = "row";

      const poolUrl = `https://stellar.expert/explorer/public/amm/pool/${p.id}`;
      tr.innerHTML = `
        <td>
          <div class="pair">
            <span class="chip">${a}</span>
            <span class="chip">/</span>
            <span class="chip">${b}</span>
          </div>
          <div class="muted" style="margin-top:6px">${p.id.slice(0,6)}â€¦${p.id.slice(-6)}</div>
        </td>
        <td>
          <div>${fmt(aAmt, 2)} <span class="muted">${a}</span></div>
          <div>${fmt(bAmt, 2)} <span class="muted">${b}</span></div>
        </td>
        <td><span class="tag">${p.fee_bp ?? "â€”"}</span></td>
        <td>${fmt(p.total_shares, 2)}</td>
        <td><a class="link" href="${poolUrl}" target="_blank" rel="noopener">View</a></td>
      `;
      rowsEl.appendChild(tr);
    }
  }

  function calcLiquidityNumber(p){
    // Heuristic: sum of reserves in their native units (not USD). Only for sorting.
    const aAmt = parseFloat(p.reserves?.[0]?.amount || 0);
    const bAmt = parseFloat(p.reserves?.[1]?.amount || 0);
    return (aAmt + bAmt);
  }

  function applyFilters(){
    const q = (qEl.value || "").trim().toUpperCase();
    let list = [...POOLS];
    if (q){
      list = list.filter(p => {
        const a = assetLabel(p.reserves?.[0]).toUpperCase();
        const b = assetLabel(p.reserves?.[1]).toUpperCase();
        return a.includes(q) || b.includes(q);
      });
    }
    const s = sortEl.value;
    switch(s){
      case "-liquidity": list.sort((x,y)=>calcLiquidityNumber(y)-calcLiquidityNumber(x)); break;
      case "liquidity": list.sort((x,y)=>calcLiquidityNumber(x)-calcLiquidityNumber(y)); break;
      case "-shares": list.sort((x,y)=>parseFloat(y.total_shares||0)-parseFloat(x.total_shares||0)); break;
      case "shares": list.sort((x,y)=>parseFloat(x.total_shares||0)-parseFloat(y.total_shares||0)); break;
      case "-fee": list.sort((x,y)=>parseInt(y.fee_bp||0)-parseInt(x.fee_bp||0)); break;
      case "fee": list.sort((x,y)=>parseInt(x.fee_bp||0)-parseInt(y.fee_bp||0)); break;
    }
    render(list);
  }

  async function fetchAll(){
    loadingEl.style.display = "block";
    statusEl.style.display = "inline-flex";
    statusEl.textContent = "Loading poolsâ€¦";

    let url = API;
    const all = [];
    try {
      // paginate Horizon until no next page (cap ~1000 to stay light)
      for (let i=0; i<5 && url; i++){
        const res = await fetch(url, {headers: {"Accept":"application/json"}});
        const data = await res.json();
        if (!data || !data._embedded) break;
        all.push(...data._embedded.records);
        // find next link
        url = data._links?.next?.href || null;
      }
      POOLS = all.map(p => ({
        id: p.id,
        fee_bp: p.fee_bp,
        total_shares: p.total_shares,
        reserves: p.reserves
      }));
      statusEl.textContent = `Loaded ${POOLS.length} pools`;
    } catch (e){
      console.error(e);
      statusEl.textContent = "Failed to load pools. Retrying laterâ€¦";
    } finally {
      loadingEl.style.display = "none";
      applyFilters();
      setTimeout(()=> statusEl.style.display = "none", 2000);
    }
  }

  // events
  qEl.addEventListener('input', () => applyFilters());
  sortEl.addEventListener('change', () => applyFilters());
  refreshBtn.addEventListener('click', () => fetchAll());

  // init
  fetchAll();
})();
</script>
</body>
  </html>
