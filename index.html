<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Laam Pools â€” Create & Explore Stellar AMMs</title>
  <meta name="description" content="Create and explore real Stellar AMM liquidity pools. Provide liquidity for pairs like XLM/Laam directly." />
  <!-- Stellar SDK Library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/stellar-sdk/11.2.1/stellar-sdk.min.js"></script>

  <style>
    :root {
      --bg: #0f1226; --card: #181b37; --muted: #9aa3b2; --txt: #e8ebf4;
      --accent: #6c7bff; --accent2: #29d3c6; --chip: #22274b; --ring: rgba(108, 123, 255, .35);
      --danger: #ff4d4d; --danger-bg: rgba(255, 77, 77, 0.1);
      --success: #29d3c6; --success-bg: rgba(41, 211, 198, 0.1);
    }
    * { box-sizing: border-box; }
    body {
      margin: 0; font-family: Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      background: radial-gradient(1200px 800px at 20% -10%, #1e2250 0%, transparent 60%), var(--bg);
      color: var(--txt); min-height: 100vh; display: flex; flex-direction: column;
    }
    header { padding: 28px 16px 8px; text-align: center; }
    .title { font-weight: 800; letter-spacing: .5px; font-size: clamp(22px, 3vw, 32px); }
    .subtitle { color: var(--muted); margin-top: 6px; font-size: 14px; }
    .shell { width: min(1100px, 95%); margin: 18px auto 40px; }
    
    /* Styles for Create Pool & Wallet Section */
    .create-pool-section {
      background: var(--card); border: 1px solid #23264b; border-radius: 16px;
      padding: 20px; margin-bottom: 20px; box-shadow: 0 8px 30px rgba(0,0,0,.2);
    }
    .create-pool-title { font-size: 18px; font-weight: 600; margin-bottom: 16px; text-align: center; }
    
    .amount-inputs { display: grid; grid-template-columns: 1fr auto 1fr; gap: 10px; align-items: center; margin-bottom: 15px; }
    .amount-inputs .asset-label { font-weight: bold; text-align: center; }
    .amount-inputs input {
      width: 100%; background: #111437; border: 1px solid #222657; border-radius: 12px;
      padding: 12px; color: var(--txt); font-size: 16px; text-align: center;
    }
    
    #secret-key-section { margin-top: 15px; padding: 15px; border-radius: 12px; background: #111437; }
    #secret-key-input {
      width: 100%; background: #0f1226; border: 1px solid #222657; border-radius: 8px;
      padding: 12px; color: var(--txt); margin-bottom: 10px;
    }
    .secret-key-warning { font-size: 12px; color: var(--danger); background: var(--danger-bg); padding: 8px; border-radius: 8px; text-align: center; margin-bottom: 10px; }
    .proceed-button {
      width: 100%; padding: 12px; border-radius: 8px; border: none; background: var(--accent);
      color: white; font-weight: bold; cursor: pointer; transition: background-color 0.2s;
    }
    .proceed-button:disabled { background: #22274b; color: var(--muted); cursor: not-allowed; }
    .proceed-button:hover:not(:disabled) { background: #5a68e8; }
    
    #status-message {
        margin-top: 15px; padding: 10px; border-radius: 8px; text-align: center; display: none;
        font-size: 14px; word-break: break-all;
    }
    #status-message.success { background: var(--success-bg); color: var(--success); }
    #status-message.error { background: var(--danger-bg); color: var(--danger); }

    .toolbar { display: grid; grid-template-columns: 1fr auto auto; gap: 10px; align-items: center; background: var(--card); padding: 14px; border-radius: 16px; box-shadow: 0 8px 30px rgba(0,0,0,.25); position: sticky; top: 12px; z-index: 5; border: 1px solid #23264b; backdrop-filter: blur(6px); }
    .search input { outline: none; border: 0; background: transparent; color: var(--txt); width: 100%; }
    .table { margin-top: 14px; background: var(--card); border-radius: 16px; overflow: hidden; border: 1px solid #23264b; }
    table { width: 100%; border-collapse: collapse; }
    thead th { text-align: left; font-size: 12px; text-transform: uppercase; letter-spacing: .08em; color: var(--muted); background: #15183a; padding: 12px 14px; border-bottom: 1px solid #23264b; }
    .spinner { margin: 40px auto; width: 44px; aspect-ratio: 1; border-radius: 50%; border: 4px solid #2b2f5c; border-top-color: var(--accent); animation: spin 1s linear infinite; }
    @keyframes spin { to { transform: rotate(1turn); } }
  </style>
</head>
<body>
  <header>
    <div class="title">Laam Pools â€” Stellar AMM</div>
    <div class="subtitle">Create & Explore Real Liquidity Pools on the Stellar Network.</div>
  </header>

  <div class="shell">
    <!-- âœ… REAL POOL CREATION SECTION -->
    <div class="create-pool-section">
      <div class="create-pool-title">Create XLM / Laam Liquidity Pool</div>
      
      <div class="amount-inputs">
        <div>
          <div class="asset-label">XLM Amount</div>
          <input type="number" id="xlm-amount" placeholder="e.g., 100">
        </div>
        <div style="font-size: 24px; color: var(--muted); margin-top: 20px;">+</div>
        <div>
          <div class="asset-label">Laam Amount</div>
          <input type="number" id="laam-amount" placeholder="e.g., 50">
        </div>
      </div>

      <div id="secret-key-section">
        <div class="secret-key-warning">
          <strong>DIGNIIN:</strong> Waligaa ha la wadaagin Secret Key-gaaga. Isticmaalkaagu waa mas'uuliyaddaada.
        </div>
        <input type="password" id="secret-key-input" placeholder="Geli Secret Key-gaaga (wuxuu ku bilaabmaa 'S')">
        <button id="proceed-btn" class="proceed-button">Create Pool Now</button>
        <div id="status-message"></div>
      </div>
    </div>

    <div class="toolbar">
      <div class="search">ðŸ”Ž<input id="q" placeholder="Filter by asset code..." /></div>
    </div>

    <div class="table">
      <div id="loading" class="spinner"></div>
      <tbody id="rows"></tbody>
    </div>
  </div>

<script>
(async function () {
  // --- âœ… REAL Pool Creation Logic ---
  const proceedBtn = document.getElementById('proceed-btn');
  const secretKeyInput = document.getElementById('secret-key-input');
  const xlmAmountInput = document.getElementById('xlm-amount');
  const laamAmountInput = document.getElementById('laam-amount');
  const statusMessageEl = document.getElementById('status-message');

  // Stellar Network and Asset Configuration
  const server = new StellarSdk.Server("https://horizon.stellar.org");
  const LAAM_CODE = "Laam";
  const LAAM_ISSUER = "GAL4ECDAXNBMJYFCWIJ32HKVIRLCNEXY664CAZYI3EINQWPLXTMEPR64";
  const assetXLM = StellarSdk.Asset.native();
  const assetLaam = new StellarSdk.Asset(LAAM_CODE, LAAM_ISSUER);

  function showStatus(message, isError = false) {
    statusMessageEl.textContent = message;
    statusMessageEl.className = isError ? 'error' : 'success';
    statusMessageEl.style.display = 'block';
  }

  proceedBtn.addEventListener('click', async () => {
    const secretKey = secretKeyInput.value.trim();
    const xlmAmount = xlmAmountInput.value.trim();
    const laamAmount = laamAmountInput.value.trim();

    // --- Input Validation ---
    if (!secretKey || !xlmAmount || !laamAmount) {
      showStatus("Fadlan buuxi dhammaan qaybaha: Secret Key, XLM Amount, iyo Laam Amount.", true);
      return;
    }
    if (parseFloat(xlmAmount) <= 0 || parseFloat(laamAmount) <= 0) {
      showStatus("Qiimayaasha waa inay ka weynaadaan eber (0).", true);
      return;
    }

    let sourceKeys;
    try {
      sourceKeys = StellarSdk.Keypair.fromSecret(secretKey);
    } catch (e) {
      showStatus("Secret Key-gaagu waa qaldan yahay. Fadlan hubi.", true);
      return;
    }

    // --- Transaction Building ---
    showStatus("Diyaarinta hawlgalka...", false);
    proceedBtn.disabled = true;
    proceedBtn.textContent = "Processing...";

    try {
      const account = await server.loadAccount(sourceKeys.publicKey());
      
      // Calculate max amounts with a small slippage tolerance (e.g., 0.5%)
      const maxAmountA = (parseFloat(xlmAmount) * 1.005).toFixed(7);
      const maxAmountB = (parseFloat(laamAmount) * 1.005).toFixed(7);

      const transaction = new StellarSdk.TransactionBuilder(account, {
        fee: await server.fetchBaseFee(),
        networkPassphrase: StellarSdk.Networks.PUBLIC,
      })
      .addOperation(StellarSdk.Operation.liquidityPoolDeposit({
        assetA: assetXLM,
        assetB: assetLaam,
        maxAmountA: maxAmountA,
        maxAmountB: maxAmountB,
        minPrice: '0.0000001', // Set a reasonable minimum price
        maxPrice: '10000000', // Set a reasonable maximum price
      }))
      .setTimeout(30)
      .build();

      transaction.sign(sourceKeys);

      showStatus("U dirida shabakadda Stellar...", false);
      const txResult = await server.submitTransaction(transaction);
      
      showStatus(`GUUL! Liquidity Pool si guul ah ayaa loo abuuray. Transaction Hash: ${txResult.hash}`, false);
      console.log("Transaction successful:", txResult);

    } catch (error) {
      console.error("Stellar Transaction Error:", error);
      let errorMessage = "Hawlgalku wuu fashilmay. ";
      if (error.response && error.response.data && error.response.data.extras) {
        errorMessage += `Sabab: ${error.response.data.extras.result_codes.operations[0]}`;
      } else {
        errorMessage += "Hubi inaad haysato lacag kugu filan iyo Trustline u furan Laam.";
      }
      showStatus(errorMessage, true);
    } finally {
      proceedBtn.disabled = false;
      proceedBtn.textContent = "Create Pool Now";
    }
  });

  // --- Existing Pool Browser Logic (Simplified) ---
  const loadingEl = document.getElementById('loading');
  loadingEl.style.display = 'none'; // Hide for now to focus on creation
  document.querySelector('.toolbar').style.display = 'none';
  document.querySelector('.table').style.display = 'none';

})();
</script>
</body>
</html>
